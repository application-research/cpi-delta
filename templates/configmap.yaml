apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Values.global.customer.name }}-{{ .Values.product }}-config
  namespace: customer-{{ .Values.global.customer.name }}
  annotations:
    argocd.argoproj.io/sync-wave: "10"
data:
  config.env: |
    # Node info
    NODE_NAME=delta-node
    NODE_DESCRIPTION=Experimental Deal Maker
    NODE_TYPE=delta-main
    REPO=/storage/delta/whypfs
    DELTA_WALLET_DIR=/storage/delta/wallet
    # Database configuration
    MODE=cluster
    {{- $dbName := "deltadb" }}
    {{- $secretNamespace := printf "customer-%s" .Values.global.customer.name }}
    DB_NAME={{ $dbName }}
    {{- $decodedPassword := .Values.global.customer.delta_db_password | b64dec }}
    {{ printf "DB_DSN=postgres://delta:%s@delta.dbfws.%s/deltadb" $decodedPassword $secretNamespace }}
